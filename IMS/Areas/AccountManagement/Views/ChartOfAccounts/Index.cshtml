<!-- افزودن CSS DataTables -->
<link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="~/css/tablesstyle.css" rel="stylesheet" />
<style>
    #costCenterTable tbody tr.selected {
        background-color: #d1f2eb !important;
    }
</style>

<!-- افزودن JS DataTables -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<div class="luxury-table-container">
    <!-- دکمه افزودن حساب -->
    <div class="add-button-container">
        <button id="addAccountBtn" class="btn-gradient-add" onclick="window.location='@Url.Action("CreateAccount", "ChartOfAccounts")'">
            <i class="fa fa-plus-circle"></i> افزودن
        </button>
    </div>

    <!-- جدول حساب‌ها -->
    <table id="costCenterTable" class="table luxury-table">
        <thead>
            <tr>
                <th>کد حساب</th>
                <th>نام حساب</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var account in Model)
            {
                <tr>
                    <td onclick="window.location='@Url.Action("Moeins", "ChartOfAccounts", new { accountId = account.Id })'">
                        @account.Code
                    </td>
                    <td onclick="window.location='@Url.Action("Moeins", "ChartOfAccounts", new { accountId = account.Id })'">
                        @account.Name
                    </td>
                    <td>
                        <div class="action-buttons">
                            <!-- دکمه ویرایش -->
                            <button class="btn-icon edit-btn" onclick="event.stopPropagation(); window.location='@Url.Action("EditAccount", "ChartOfAccounts", new { id = account.Id })'">
                                <i class="fa fa-edit"></i>
                            </button>

                            <!--Delete-->
                            <form method="post" action="@Url.Action("Delete", "ChartOfAccounts")" style="display:inline;">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@account.Id" />
                                <button type="submit" class="btn-icon delete-btn" onclick="return confirm('آیا از حذف این حساب مطمئن هستید؟')">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </form>


                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script>
     $(document).ready(function () {
       
        var table = $('#costCenterTable').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            pageLength: 10,
            lengthMenu: [5, 10, 25, 50, 100],
            info: true,
            language: {
                url: "https://cdn.datatables.net/plug-ins/1.13.6/i18n/fa.json"
            },
            columnDefs: [
                { targets: [0, 1], orderable: true },
            ]
        });

        // افزودن تغییرات برای برجسته کردن سطر
        $('#costCenterTable tbody').on('mouseenter', 'tr', function() {
            $(this).css('background-color', '#e0f7fa'); // رنگ برجسته شدن
        }).on('mouseleave', 'tr', function() {
            $(this).css('background-color', ''); // بازگرداندن به رنگ اصلی
        });
    });




    document.addEventListener("DOMContentLoaded", function () {
        const table = document.getElementById("costCenterTable");
        const rows = table.querySelectorAll("tbody tr");
        let selectedIndex = -1;

        function highlightRow(index) {
            rows.forEach((row, i) => {
                row.classList.toggle("selected", i === index);
            });
        }

        document.addEventListener("keydown", function (event) {
            const key = event.key;

            // ArrowDown → سطر بعدی
            if (key === "ArrowDown") {
                if (selectedIndex < rows.length - 1) {
                    selectedIndex++;
                    highlightRow(selectedIndex);
                    rows[selectedIndex].scrollIntoView({ block: "center", behavior: "smooth" });
                    event.preventDefault();
                }
            }

            // ArrowUp → سطر قبلی
            if (key === "ArrowUp") {
                if (selectedIndex > 0) {
                    selectedIndex--;
                    highlightRow(selectedIndex);
                    rows[selectedIndex].scrollIntoView({ block: "center", behavior: "smooth" });
                    event.preventDefault();
                }
            }

            // Enter → رفتن به صفحه معین
            if (key === "Enter" && selectedIndex >= 0) {
                const row = rows[selectedIndex];
                const firstCell = row.querySelector("td");
                if (firstCell && firstCell.onclick) {
                    firstCell.onclick(); // اجرای همان window.location که در <td onclick="..."> هست
                }
            }

            // Delete → حذف
            if (key === "Delete" && selectedIndex >= 0) {
                const form = rows[selectedIndex].querySelector("form");
                if (form && confirm("آیا از حذف این حساب مطمئن هستید؟")) {
                    form.submit();
                }
            }

            // Shift + E → ویرایش
            if ((event.shiftKey && key.toLowerCase() === "e") && selectedIndex >= 0) {
                const editBtn = rows[selectedIndex].querySelector(".edit-btn");
                if (editBtn) {
                    editBtn.click();
                    event.preventDefault();
                }
            }

            // Alt + Shift + N → افزودن حساب
            if (event.altKey && event.shiftKey && key.toLowerCase() === "n") {
                const addBtn = document.getElementById("addAccountBtn");
                if (addBtn) {
                    addBtn.click();
                    event.preventDefault();
                }
            }
            
            
            
            // Escape → بازگشت به صفحه Index از کنترلر Accounts
            if (key === "Escape") {
                window.location.href = "/Chart/Index";
            }

        });
    });

</script>
