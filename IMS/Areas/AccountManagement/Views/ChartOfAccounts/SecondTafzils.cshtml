@model List<IMS.Areas.AccountManagement.Models.SecondTafzil>

@{
    ViewData["Title"] = "تفصیل سطح دوم";
    var tafzilName = Model.FirstOrDefault()?.Tafzil?.Name;
}
<style>
    .selected {
        background-color: #d1f2eb !important;
    }

</style>
<link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="~/css/tablesstyle.css" rel="stylesheet" />

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

@if (!string.IsNullOrEmpty(tafzilName))
{
    <div class="alert alert-info text-center fw-bold mb-4">
        تفصیل سطح اول: @tafzilName
    </div>
}

<div class="button-container d-flex justify-content-between mb-3">
    <a class="btn btn-gradient-add" href="@Url.Action("CreateSecondTafzil", "ChartOfAccounts", new { tafzilId = Model.FirstOrDefault()?.TafzilId })">
        <i class="fa fa-plus-circle"></i> افزودن تفصیل ۲
    </a>
    <a href="@Url.Action("Index", "ChartOfAccounts")" class="btn btn-secondary">
        <i class="fa fa-arrow-left"></i> بازگشت
    </a>
</div>

<table id="secondTafzilTable" class="table luxury-table">
    <thead>
        <tr>
            <th>کد کل</th>
            <th>کد معین</th>
            <th>کد تفصیل ۱</th>
            <th>کد تفصیل ۲</th>
            <th>نام تفصیل ۲</th>
            <th>عملیات</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Tafzil?.Moein?.Account?.Code</td>
                <td>@item.Tafzil?.Moein?.Code</td>
                <td>@item.Tafzil?.Code</td>
                <td>@item.Code</td>
                <td>@item.Name</td>
                <td>
                    <div class="action-buttons">
                        <a class="btn-icon edit-btn" href="@Url.Action("EditSecondTafzil", "ChartOfAccounts", new { id = item.Id })">
                            <i class="fa fa-edit"></i>
                        </a>
                        <a class="btn-icon delete-btn" onclick="return confirm('آیا از حذف این تفصیل ۲ مطمئن هستید؟');"
                           href="@Url.Action("DeleteSecondTafzil", "ChartOfAccounts", new { id = item.Id })">
                            <i class="fa fa-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>

<script>
    $(document).ready(function () {
        $('#secondTafzilTable').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            pageLength: 10,
            lengthMenu: [5, 10, 25, 50, 100],
            info: true,
            language: {
                url: "https://cdn.datatables.net/plug-ins/1.13.6/i18n/fa.json"
            }
        });

        $('#secondTafzilTable tbody').on('mouseenter', 'tr', function () {
            $(this).css('background-color', '#f0f9ff');
        }).on('mouseleave', 'tr', function () {
            $(this).css('background-color', '');
        });
    });


    document.addEventListener("DOMContentLoaded", function () {
        const table = document.getElementById("secondTafzilTable");
        if (!table) return;

        const rows = table.querySelectorAll("tbody tr");
        let selectedIndex = -1;

        // مشخص کردن سطر انتخاب شده با کلاس CSS مثلا 'selected'
        function highlightRow(index) {
            rows.forEach((row, i) => {
                row.classList.toggle("selected", i === index);
            });
        }

        document.addEventListener("keydown", function (event) {
            const key = event.key;

            // ArrowDown → سطر بعدی
            if (key === "ArrowDown") {
                if (selectedIndex < rows.length - 1) {
                    selectedIndex++;
                    highlightRow(selectedIndex);
                    rows[selectedIndex].scrollIntoView({ block: "center", behavior: "smooth" });
                    event.preventDefault();
                }
            }

            // ArrowUp → سطر قبلی
            if (key === "ArrowUp") {
                if (selectedIndex > 0) {
                    selectedIndex--;
                    highlightRow(selectedIndex);
                    rows[selectedIndex].scrollIntoView({ block: "center", behavior: "smooth" });
                    event.preventDefault();
                }
            }

            // Delete → حذف سطر انتخاب شده با تایید کاربر
            if (key === "Delete" && selectedIndex >= 0) {
                const row = rows[selectedIndex];
                const deleteBtn = row.querySelector(".delete-btn");
                if (deleteBtn && confirm("آیا از حذف این تفصیل ۲ مطمئن هستید؟")) {
                    window.location.href = deleteBtn.getAttribute("href");
                }
            }

            // Shift + E → ویرایش سطر انتخاب شده
            if (event.shiftKey && key.toLowerCase() === "e" && selectedIndex >= 0) {
                const row = rows[selectedIndex];
                const editBtn = row.querySelector(".edit-btn");
                if (editBtn) {
                    window.location.href = editBtn.getAttribute("href");
                    event.preventDefault();
                }
            }

            // Alt + Shift + N → افزودن تفصیل جدید
            if (event.altKey && event.shiftKey && key.toLowerCase() === "n") {
                const addBtn = document.querySelector(".btn-gradient-add");
                if (addBtn) {
                    addBtn.click();
                    event.preventDefault();
                }
            }




            if (key === "Escape") {
                history.back(); // برمی‌گرده به صفحه قبلی مرورگر
            }
        });
    });

</script>
